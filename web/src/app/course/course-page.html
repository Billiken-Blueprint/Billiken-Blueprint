<div class="course-page-root p-4 md:p-8">

  <!-- TOOLBOX TOGGLE BUTTON -->
  <button id="toolbox-toggle" (click)="toolboxOpen = !toolboxOpen">
    <svg id="menu-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
         [class.hidden]="toolboxOpen">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 6h16M4 12h16m-7 6h7"></path>
    </svg>
    <svg id="close-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
         [class.hidden]="!toolboxOpen">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>

  <!-- TOOLBOX SIDEBAR -->
  <div id="toolbox" class="flex flex-col p-6 space-y-4" [class.open]="toolboxOpen">
    <h3 class="text-3xl font-extrabold text-white mb-2 border-b border-[#53C3EE]/50 pb-2">
      Tools Menu
    </h3>

    <div class="space-y-4 flex-1 overflow-y-auto">

      <!-- My Saved Courses -->
      <div class="bg-white/10 rounded-lg p-4 text-white">
        <button id="saved-toggle" class="w-full flex items-center justify-between font-semibold"
                (click)="savedOpen = !savedOpen">
          <span>My Saved Courses</span>
          <span id="saved-toggle-icon" class="text-sm">
            {{ savedOpen ? '‚ñæ' : '‚ñ∏' }}
          </span>
        </button>

        <div id="saved-panel" class="mt-3 space-y-3" [class.hidden]="!savedOpen">
          <ul id="saved-list" class="space-y-1 text-sm max-h-60 overflow-y-auto">
            <li *ngIf="savedCourses.length === 0" class="text-white/70">
              No courses saved yet.
            </li>
            <li *ngFor="let sc of savedCourses"
                class="flex items-center justify-between gap-2 bg-white/10 rounded px-2 py-1">
              {{ sc.code }} ‚Äì {{ sc.title }}
            </li>
          </ul>
          <button
            id="clear-saved"
            type="button"
            class="mt-2 text-xs px-3 py-1 rounded-full bg-white/20 hover:bg-white/30 transition"
            (click)="clearSaved()"
          >
            üóë Clear All
          </button>
        </div>
      </div>

      <!-- Other toolbox buttons -->
      <button class="toolbox-btn w-full text-left font-semibold py-3 px-4 rounded-lg flex items-center">
        <svg class="w-5 h-5 inline-block mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        Degree Progress
      </button>

      <button class="toolbox-btn w-full text-left font-semibold py-3 px-4 rounded-lg flex items-center">
        <svg class="w-5 h-5 inline-block mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        Time Conflict Checker
      </button>
    </div>
  </div>

  <!-- main app -->
  <div id="app" class="max-w-6xl mx-auto">
    <header class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-extrabold mb-2 tracking-wide">
        Build Your Perfect Schedule
      </h1>
      <p class="text-xl text-[#003DA5]/80">
        Explore Computer Science courses and save your favorites.
      </p>
    </header>

    <!-- box displaying all courses under button -->
    <div id="content-display" class="card-container p-6 md:p-10 rounded-xl mb-12 border border-[#CBC9C7]">
      <p
        id="initial-message"
        class="text-center text-xl text-[#003DA5]/50 p-10 transition-opacity duration-300"
        *ngIf="!selectedGroup"
      >
        Click any button below to view course groups. Click a course to expand, or use ‚Äú+ Add‚Äù to save it.
      </p>

      <div
        id="course-cards"
        class="hidden grid gap-6"
        [class.hidden]="!selectedGroup"
      >
        <div
          *ngFor="let course of groupCourses"
          class="bb-course-card p-4 rounded-xl relative"
        >
          <div class="pr-10">
            <div class="flex items-center mb-1">
              <p class="font-semibold cursor-pointer" (click)="toggleCourseDescription(course.code)">
                {{ course.code }} ‚Äì {{ course.title }}
              </p>
              <span *ngIf="hasLocationInfo(course.code)" 
                    class="ml-2 px-2 py-0.5 text-xs font-semibold rounded-full bg-green-100 text-green-700 border border-green-300 whitespace-nowrap">
                Spring 2026
              </span>
            </div>
            
            <!-- Course details from course-info - exact format match -->
            <ng-container *ngIf="expandedCourseCode === course.code && getCourseDetails(course.code) as details">
              <article class="course-info-expanded mt-3">
                <header class="card-head">
                  <span class="credit-pill">{{ details.credits }} credit{{ details.credits === 1 ? '' : 's' }}</span>
                </header>

                <div *ngIf="details.meetingTimes || details.location" class="meta">
                  <div *ngIf="details.meetingTimes"><strong>Times:</strong> {{ details.meetingTimes }}</div>
                  <div *ngIf="details.location"><strong>Location:</strong> {{ details.location }}</div>
                </div>

                <div class="actions">
                  <button (click)="toggleDesc(course.code)" class="btn-outline">
                    {{ details.expandedDesc ? 'Hide description' : 'Course description' }}
                  </button>

                  <button (click)="toggleInstructors(course.code)" class="btn-outline">
                    {{ details.expandedInstructors ? 'Hide instructors' : 'Instructor list' }}
                  </button>
                </div>

                <!-- Course description -->
                <section *ngIf="details.expandedDesc" class="details">
                  <div *ngIf="details.description">
                    <h3 class="section-title">Description</h3>
                    <p class="para">{{ details.description }}</p>
                  </div>

                  <div *ngIf="details.prerequisites">
                    <h3 class="section-title">Prerequisites</h3>
                    <p class="mono">{{ details.prerequisites }}</p>
                  </div>

                  <div *ngIf="details.attributes">
                    <h3 class="section-title">Attributes</h3>
                    <p class="para">{{ details.attributes }}</p>
                  </div>
                </section>

                <!-- Instructor list with ratings -->
                <section *ngIf="details.expandedInstructors" class="details">
                  <div *ngFor="let inst of details.instructors || []" class="instructor-row">
                    <div class="inst-main">
                      <p class="inst-name" [class.cursor-pointer]="hasInstructorReviews(inst)" 
                         [class.hover\:underline]="hasInstructorReviews(inst)"
                         (click)="openReviewsPage(inst)">{{ inst.name }}</p>
                      <p *ngIf="inst.email" class="inst-line">{{ inst.email }}</p>
                      <p *ngIf="inst.office" class="inst-line">{{ inst.office }}</p>
                    </div>

                    <div *ngIf="inst.rating" class="inst-rating">
                      <div><strong>Overall Rating:</strong> {{ inst.rating.overall }}/5</div>
                      <div><strong>Rating Numbers:</strong> {{ inst.rating.numRatings }}</div>
                      <button *ngIf="hasInstructorReviews(inst)" 
                              (click)="openReviewsPage(inst); $event.stopPropagation()"
                              class="rmp-link-button text-blue-600 hover:text-blue-800 underline cursor-pointer">
                        View reviews
                      </button>
                      <a *ngIf="inst.rating.rmpUrl && !hasInstructorReviews(inst)" 
                         [href]="inst.rating.rmpUrl" class="rmp-link" rel="noopener" target="_blank">
                        See reviews on RMP
                      </a>
                    </div>
                  </div>

                  <p *ngIf="!details.instructors || details.instructors.length === 0" class="muted">Instructor TBA</p>
                </section>
              </article>
            </ng-container>
            
            <!-- Fallback if course details not found -->
            <div *ngIf="expandedCourseCode === course.code && !getCourseDetails(course.code)" class="mt-3">
              <p class="text-[#003DA5]/80 italic text-sm">
              Course details coming soon.
            </p>
            </div>
          </div>

          <button
            type="button"
            class="add-course-btn absolute top-2 right-2 text-xs px-2 py-1 rounded-full font-semibold shadow z-10"
            [class.bg-[#53C3EE]]="!isCourseSaved(course)"
            [class.bg-green-400]="isCourseSaved(course)"
            [class.text-[#003DA5]]="true"
            (click)="addCourse(course, $event)"
          >
            {{ isCourseSaved(course) ? '‚úî Added' : '+ Add' }}
          </button>
        </div>
      </div>
    </div>

    <!-- SECTION 1: CORE CSCI COURSES -->
    <section class="mb-12">
      <h2 class="text-3xl font-bold mb-6">Core Courses</h2>
      <div class="flex flex-wrap justify-center gap-4">
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Core_Intro'"
          [class.ring-accent]="selectedGroup === 'Core_Intro'"
          [class.ring-opacity-50]="selectedGroup === 'Core_Intro'"
          (click)="onSelectGroup('Core_Intro')"
        >
          Intro to CS
        </button>
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Core_Prog'"
          [class.ring-accent]="selectedGroup === 'Core_Prog'"
          [class.ring-opacity-50]="selectedGroup === 'Core_Prog'"
          (click)="onSelectGroup('Core_Prog')"
        >
          Programming &amp; Data Structures
        </button>
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Core_Software'"
          [class.ring-accent]="selectedGroup === 'Core_Software'"
          [class.ring-opacity-50]="selectedGroup === 'Core_Software'"
          (click)="onSelectGroup('Core_Software')"
        >
          Software Design &amp; Engineering
        </button>
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Core_Systems'"
          [class.ring-accent]="selectedGroup === 'Core_Systems'"
          [class.ring-opacity-50]="selectedGroup === 'Core_Systems'"
          (click)="onSelectGroup('Core_Systems')"
        >
          Systems &amp; Architecture
        </button>
      </div>
    </section>

    <!-- SECTION 2: STEM & ETHICS -->
    <section class="mb-12">
      <h2 class="text-3xl font-bold mb-6">STEM &amp; Ethics</h2>
      <div class="flex flex-wrap justify-center gap-4">
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Stem_MathCore'"
          [class.ring-accent]="selectedGroup === 'Stem_MathCore'"
          [class.ring-opacity-50]="selectedGroup === 'Stem_MathCore'"
          (click)="onSelectGroup('Stem_MathCore')"
        >
          Math Core
        </button>
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Stem_MathAdv'"
          [class.ring-accent]="selectedGroup === 'Stem_MathAdv'"
          [class.ring-opacity-50]="selectedGroup === 'Stem_MathAdv'"
          (click)="onSelectGroup('Stem_MathAdv')"
        >
          Advanced Math &amp; Stats
        </button>
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Stem_Science'"
          [class.ring-accent]="selectedGroup === 'Stem_Science'"
          [class.ring-opacity-50]="selectedGroup === 'Stem_Science'"
          (click)="onSelectGroup('Stem_Science')"
        >
          Science &amp; Engineering
        </button>
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Stem_Ethics'"
          [class.ring-accent]="selectedGroup === 'Stem_Ethics'"
          [class.ring-opacity-50]="selectedGroup === 'Stem_Ethics'"
          (click)="onSelectGroup('Stem_Ethics')"
        >
          Ethics
        </button>
      </div>
    </section>

    <!-- SECTION 3: ELECTIVES -->
    <section class="mb-12">
      <h2 class="text-3xl font-bold mb-6">Electives</h2>
      <div class="flex flex-wrap justify-center gap-4">
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Electives_Systems'"
          [class.ring-accent]="selectedGroup === 'Electives_Systems'"
          [class.ring-opacity-50]="selectedGroup === 'Electives_Systems'"
          (click)="onSelectGroup('Electives_Systems')"
        >
          Systems Electives
        </button>
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Electives_AIData'"
          [class.ring-accent]="selectedGroup === 'Electives_AIData'"
          [class.ring-opacity-50]="selectedGroup === 'Electives_AIData'"
          (click)="onSelectGroup('Electives_AIData')"
        >
          AI &amp; Data Science
        </button>
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Electives_Software'"
          [class.ring-accent]="selectedGroup === 'Electives_Software'"
          [class.ring-opacity-50]="selectedGroup === 'Electives_Software'"
          (click)="onSelectGroup('Electives_Software')"
        >
          Software &amp; UX
        </button>
        <button
          class="action-btn btn-accent rounded-full px-6 py-3 shadow-xl"
          [class.ring-4]="selectedGroup === 'Electives_Capstone'"
          [class.ring-accent]="selectedGroup === 'Electives_Capstone'"
          [class.ring-opacity-50]="selectedGroup === 'Electives_Capstone'"
          (click)="onSelectGroup('Electives_Capstone')"
        >
          Capstone &amp; Experience
        </button>
      </div>
    </section>
  </div>
</div>
