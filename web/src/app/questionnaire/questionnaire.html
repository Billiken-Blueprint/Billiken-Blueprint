<div class="questionnaire-container">
  <div class="questionnaire-card">

    <!-- Progress Bar -->
    <div class="progress-section">
      <div class="progress-bar">
        <div [style.width.%]="(currentStep / totalSteps) * 100" class="progress-fill"></div>
      </div>
      <div class="step-numbers">
        @for (step of [1, 2, 3]; track step) {
          <span (click)="goToStep(step)"
                [class.active]="step <= currentStep"
                [class.current]="step === currentStep"
                class="step-num">
            {{ step }}
          </span>
        }
      </div>
    </div>

    <!-- Title -->
    <h2>{{ getStepTitle() }}</h2>

    <!-- Scrollable Content Area -->
    <div class="content-area">
      <form (ngSubmit)="onSubmit()" [formGroup]="questionnaireForm">

        <!-- Step 1: Personal Information -->
        @if (currentStep === 1) {
          <div class="step-section">
            <div class="form-group">
              <label for="fullName">Full Name *</label>
              <input class="input-field" formControlName="fullName" id="fullName" placeholder="Enter your full name"/>
            </div>

            <div class="form-group">
              <label for="graduationYear">Expected Graduation Year *</label>
              <input class="input-field" formControlName="graduationYear" id="graduationYear" max="2030"
                     min="2024" placeholder="e.g., 2026" type="number"/>
            </div>

            <div class="form-group">
              <label for="major">Major *</label>
              <p-select [options]="majors" formControlName="major" id="major" placeholder="Select your major"/>
            </div>

            <div class="form-group">
              <label for="minor">Minor (optional)</label>
              <p-select [options]="minors" formControlName="minor" id="minor" placeholder="Select your minor"/>
            </div>
          </div>
        }

        <!-- Step 2: Course Selection -->
        @if (currentStep === 2) {
          <div class="step-section">
            <p class="description">Select courses you've already taken</p>
            <p-multi-select [options]="courses" fluid
                            formControlName="completedCourses" optionLabel="courseCode" placeholder="Select courses">
              <ng-template #item let-course>
                <div><strong>{{ course.courseCode }}</strong> - ({{ course.title }})</div>
              </ng-template>
            </p-multi-select>
          </div>
        }

        <!-- Step 3: Review -->
        @if (currentStep === 3) {
          <div class="step-section">
            <h4 style="color: #1e3a8a; margin-bottom: 24px;">Review Your Information</h4>
            <div class="review-list">
              <div class="review-item">
                <strong>Name:</strong>
                <span>{{ questionnaireForm.get('fullName')?.value || 'Not provided' }}</span>
              </div>
              <div class="review-item">
                <strong>Graduation Year:</strong>
                <span>{{ questionnaireForm.get('graduationYear')?.value || 'Not provided' }}</span>
              </div>
              <div class="review-item">
                <strong>Major:</strong> <span>{{ questionnaireForm.get('major')?.value || 'Not provided' }}</span>
              </div>
              @if (questionnaireForm.get('minor')?.value) {
                <div class="review-item">
                  <strong>Minor:</strong> <span>{{ questionnaireForm.get('minor')?.value }}</span>
                </div>
              }
              <div class="review-item">
                <strong>Prior Courses:</strong>
                <span>{{ questionnaireForm.get('completedCourses')?.value?.length || '0' }} selected</span>
              </div>
            </div>
          </div>
        }
      </form>
    </div>

    <!-- Fixed Navigation at Bottom -->
    <div class="navigation">
      @if (currentStep > 1) {
        <button (click)="previousStep()" class="btn-secondary" type="button">Previous</button>
      }
      <div class="nav-right">
        @if (currentStep < totalSteps) {
          <button (click)="nextStep()" [disabled]="!isCurrentStepValid()" class="btn-primary" type="button">Next
          </button>
        }
        @if (currentStep === totalSteps) {
          <button (click)="onSubmit()" [disabled]="!questionnaireForm.valid" class="btn-primary" type="submit">Complete
            Profile
          </button>
        }
      </div>
    </div>
  </div>
</div>
