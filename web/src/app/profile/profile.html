<div class="profile-container">
  <div class="profile-card">
    <h2>User Profile</h2>

    <!-- Profile Display Mode -->
    <div *ngIf="!isEditing" class="profile-display">
      <div class="profile-actions">
        <button
          (click)="enableEdit()"
          class="btn btn-primary"
        >Edit Profile
        </button>
      </div>

      <div class="tab-content">
        <!-- Personal Information -->
        <div class="tab-section">
          <h3>Personal Information</h3>
          <div class="divider"></div>
          <div class="info-section">
            <div class="info-row">
              <label>Full Name:</label>
              <span>{{ userProfile.fullName || 'Not provided' }}</span>
            </div>
            <div class="info-row">
              <label>Age:</label>
              <span>{{ userProfile.age || 'Not provided' }}</span>
            </div>
            <div class="info-row">
              <label>Date of Birth:</label>
              <span>{{ userProfile.dateOfBirth ? (userProfile.dateOfBirth | date:'mediumDate') : 'Not provided' }}</span>
            </div>
            <div class="info-row">
              <label>Expected Graduation Year:</label>
              <span>{{ userProfile.graduationYear || 'Not provided' }}</span>
            </div>
          </div>
        </div>

        <!-- Academic Information -->
        <div class="tab-section">
          <h3>Academic Information</h3>
          <div class="divider"></div>
          <div class="info-section">
            <div class="info-row">
              <label>Current Semester:</label>
              <span>{{ userProfile.currentSemester || 'Not provided' }}</span>
            </div>
            <div class="info-row">
              <label>Major:</label>
              <span>{{ userProfile.major || 'Not provided' }}</span>
            </div>
            <div class="info-row">
              <label>Minor:</label>
              <span>{{ userProfile.minor || 'None' }}</span>
            </div>
            <div class="info-row">
              <label>Total Credits Completed:</label>
              <span class="credits-badge">{{ userProfile.totalCredits || 0 }} credits</span>
            </div>
          </div>
        </div>

        <!-- Completed Courses -->
        <div class="tab-section">
          <h3>Completed Courses</h3>
          <div class="divider"></div>
          <div class="info-section">
            <div *ngIf="getCompletedCoursesDisplay().length > 0; else noCourses">
              <div class="course-list">
                <div *ngFor="let course of getCompletedCoursesDisplay()" class="course-item-display">
                  {{ course }}
                </div>
              </div>
            </div>
            <ng-template #noCourses>
              <p class="no-data">No completed courses recorded.</p>
            </ng-template>
          </div>
        </div>

        <!-- Schedule Preferences -->
        <div class="tab-section">
          <h3>Schedule Preferences</h3>
          <div class="divider"></div>
          <div class="info-section">
            <div class="schedule-info">
              <h4>Unavailable Times</h4>
              <div *ngIf="getTimeSlotDisplay(userProfile.unavailableTimes || []).length > 0; else noUnavailable">
                <div class="time-list">
                  <span *ngFor="let time of getTimeSlotDisplay(userProfile.unavailableTimes || [])"
                        class="time-badge unavailable">
                    {{ time }}
                  </span>
                </div>
                <div *ngIf="userProfile.unavailableReason" class="reason">
                  <strong>Reason:</strong> {{ userProfile.unavailableReason }}
                </div>
              </div>
              <ng-template #noUnavailable>
                <p class="no-data">No unavailable times specified.</p>
              </ng-template>
            </div>

            <div class="divider-small"></div>

            <div class="schedule-info">
              <h4>Preferred Not Times</h4>
              <div *ngIf="getTimeSlotDisplay(userProfile.preferredNotTimes || []).length > 0; else noPreferred">
                <div class="time-list">
                  <span *ngFor="let time of getTimeSlotDisplay(userProfile.preferredNotTimes || [])"
                        class="time-badge preferred-not">
                    {{ time }}
                  </span>
                </div>
                <div *ngIf="userProfile.preferredNotReason" class="reason">
                  <strong>Reason:</strong> {{ userProfile.preferredNotReason }}
                </div>
              </div>
              <ng-template #noPreferred>
                <p class="no-data">No preferred not times specified.</p>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Edit Mode -->
    <div *ngIf="isEditing" class="profile-edit">
      <div class="edit-actions">
        <button
          (click)="saveProfile()"
          [disabled]="!profileForm.valid"
          class="btn btn-primary"
        >Save Changes
        </button>
        <button
          (click)="cancelEdit()"
          class="btn btn-secondary"
        >Cancel
        </button>
      </div>

      <form [formGroup]="profileForm">
        <div class="tab-content">
          <!-- Personal Information Tab -->
          <div class="tab-section">
            <h3>Personal Information</h3>
            <div class="divider"></div>
            <div class="form-section">
              <div class="form-row">
                <div class="form-field">
                  <label for="fullName">Full Name *</label>
                  <input
                    class="form-control"
                    formControlName="fullName"
                    id="fullName"
                    placeholder="Enter your full name"
                  />
                </div>

                <div class="form-field">
                  <label for="age">Age *</label>
                  <input
                    class="form-control"
                    formControlName="age"
                    id="age"
                    placeholder="Enter your age"
                    type="number"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-field">
                  <label for="dateOfBirth">Date of Birth *</label>
                  <input
                    class="form-control"
                    formControlName="dateOfBirth"
                    id="dateOfBirth"
                    type="date"
                  />
                </div>

                <div class="form-field">
                  <label for="graduationYear">Expected Graduation Year *</label>
                  <input
                    class="form-control"
                    formControlName="graduationYear"
                    id="graduationYear"
                    placeholder="e.g., 2026"
                    type="number"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Academic Information Tab -->
          <div class="tab-section">
            <h3>Academic Information</h3>
            <div class="divider"></div>
            <div class="form-section">
              <div class="form-row">
                <div class="form-field">
                  <label for="currentSemester">Current Semester *</label>
                  <select
                    class="form-control"
                    formControlName="currentSemester"
                    id="currentSemester"
                  >
                    <option value="">Select your current semester</option>
                    <option *ngFor="let semester of semesters" [value]="semester">{{ semester }}</option>
                  </select>
                </div>

                <div class="form-field">
                  <label for="major">Major *</label>
                  <select
                    class="form-control"
                    formControlName="major"
                    id="major"
                  >
                    <option value="">Select your major</option>
                    <option *ngFor="let major of majors" [value]="major">{{ major }}</option>
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-field">
                  <label for="minor">Minor</label>
                  <select
                    class="form-control"
                    formControlName="minor"
                    id="minor"
                  >
                    <option value="">Select your minor (optional)</option>
                    <option *ngFor="let minor of minors" [value]="minor">{{ minor }}</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- Completed Courses Tab -->
          <div class="tab-section">
            <h3>Completed Courses</h3>
            <div class="divider"></div>
            <div class="form-section">
              <div class="course-selection-buttons">
                <button
                  (click)="selectAllCourses()"
                  class="btn btn-secondary"
                  type="button"
                >Select All
                </button>
                <button
                  (click)="deselectAllCourses()"
                  class="btn btn-secondary"
                  type="button"
                >Deselect All
                </button>
              </div>

              <div class="courses-grid" formArrayName="completedCourses">
                <div
                  *ngFor="let course of courses; let i = index"
                  class="course-item"
                >
                  <input
                    [formControlName]="i"
                    [id]="'course-' + i"
                    type="checkbox"
                  />
                  <label [for]="'course-' + i" class="course-label">
                    <strong>{{ course.code }}</strong> - {{ course.name }} ({{ course.credits }} credits)
                  </label>
                </div>
              </div>

              <div class="credits-summary">
                <strong>Total Credits: {{ calculateTotalCredits() }}</strong>
              </div>
            </div>
          </div>

          <!-- Schedule Preferences Tab -->
          <div class="tab-section">
            <h3>Schedule Preferences</h3>
            <div class="divider"></div>
            <div class="form-section">
              <div class="schedule-section">
                <h4>Times you absolutely cannot take classes</h4>
                <div class="time-slots-grid" formArrayName="unavailableTimes">
                  <div
                    *ngFor="let timeSlot of timeSlots; let i = index"
                    class="time-slot-item"
                  >
                    <input
                      [formControlName]="i"
                      [id]="'unavailable-' + i"
                      type="checkbox"
                    />
                    <label [for]="'unavailable-' + i">{{ timeSlot.label }}</label>
                  </div>
                </div>

                <div class="form-field">
                  <label for="unavailableReason">Reason for unavailability</label>
                  <textarea
                    class="form-control"
                    formControlName="unavailableReason"
                    id="unavailableReason"
                    placeholder="e.g., Work schedule, family commitments, etc."
                    rows="3"
                  ></textarea>
                </div>
              </div>

              <div class="schedule-section">
                <h4>Times you prefer not to take classes</h4>
                <div class="time-slots-grid" formArrayName="preferredNotTimes">
                  <div
                    *ngFor="let timeSlot of timeSlots; let i = index"
                    class="time-slot-item"
                  >
                    <input
                      [formControlName]="i"
                      [id]="'preferred-not-' + i"
                      type="checkbox"
                    />
                    <label [for]="'preferred-not-' + i">{{ timeSlot.label }}</label>
                  </div>
                </div>

                <div class="form-field">
                  <label for="preferredNotReason">Reason for preference</label>
                  <textarea
                    class="form-control"
                    formControlName="preferredNotReason"
                    id="preferredNotReason"
                    placeholder="e.g., Personal preference, other activities, etc."
                    rows="3"
                  ></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
